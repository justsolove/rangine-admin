(window.webpackJsonp=window.webpackJsonp||[]).push([["chunk-2d0a4fb9"],{"0982":function(e,t,n){"use strict";n.r(t);n("8e6e"),n("456d"),n("55dd"),n("7514"),n("28a5");var a=n("bd86"),d=(n("ac6a"),n("b9ad"));function i(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(t);e&&(a=a.filter(function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})),n.push.apply(n,a)}return n}function u(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?i(n,!0).forEach(function(e){Object(a.a)(t,e,n[e])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):i(n).forEach(function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))})}return t}var o={props:{loading:{default:!1},typeData:{default:function(){return[]}},tableData:{default:function(){return[]}},selectId:{default:null}},data:function(){return{currentTableData:[],multipleSelection:[],auth:{add:!1,set:!1,del:!1,sort:!1,index:!1,close:!1},indexMap:{0:{text:"否",type:"danger"},1:{text:"是",type:"success"},2:{text:"...",type:"info"}},dialogLoading:!1,dialogFormVisible:!1,dialogStatus:"",textMap:{update:"编辑规格",create:"新增规格"},form:{goods_type_id:void 0,name:void 0,spec_item:void 0,spec_index:void 0,sort:void 0},rules:{name:[{required:!0,message:"名称不能为空",trigger:"blur"},{max:60,message:"长度不能大于 60 个字符",trigger:"blur"}],goods_type_id:[{required:!0,message:"至少选择一项",trigger:"change"}],spec_item:[{required:!0,message:"规格项不能为空",trigger:"blur"}],sort:[{type:"number",message:"必须为数字值",trigger:"blur"}]}}},watch:{tableData:{handler:function(e){this.currentTableData=e},immediate:!0}},filters:{getSpecItem:function(e){if(e)return e.join(",")}},mounted:function(){this._validationAuth()},methods:{_validationAuth:function(){this.auth.add=this.$has("/goods/setting/spec/add"),this.auth.set=this.$has("/goods/setting/spec/set"),this.auth.del=this.$has("/goods/setting/spec/del"),this.auth.sort=this.$has("/goods/setting/spec/sort"),this.auth.index=this.$has("/goods/setting/spec/index"),this.auth.close=this.$has("/goods/setting/spec/close")},_getIdList:function(e){null===e&&(e=this.multipleSelection);var t=[];return Array.isArray(e)?e.forEach(function(e){t.push(e.spec_id)}):t.push(this.currentTableData[e].spec_id),t},sortChange:function(e){var t=e.column,n=e.prop,a=e.order,i={order_type:void 0,order_field:void 0};t&&a&&(i.order_type="ascending"===a?"asc":"desc",i.order_field=n),this.$emit("sort",i)},handleSelectionChange:function(e){this.multipleSelection=e},handleCreate:function(){var e=this;this.form={goods_type_id:this.selectId,name:"",spec_item:"",spec_index:1,sort:50},this.$nextTick(function(){e.$refs.form.clearValidate()}),this.dialogStatus="create",this.dialogLoading=!1,this.dialogFormVisible=!0},create:function(){var n=this;this.$refs.form.validate(function(e){e&&(n.dialogLoading=!0,Object(d.a)(u({},n.form,{spec_item:n.form.spec_item.trim().split("\n")})).then(function(t){n.currentTableData.unshift(u({},t.data,{get_goods_type:u({},n.typeData.find(function(e){return e.goods_type_id===t.data.goods_type_id}))})),n.dialogFormVisible=!1,n.$message.success("操作成功")}).catch(function(){n.dialogLoading=!1}))})},handleUpdate:function(e){var t=this;this.currentIndex=e;var n=this.currentTableData[e];this.form=u({},n,{spec_item:n.spec_item.join("\n")}),this.$nextTick(function(){t.$refs.form.clearValidate()}),this.dialogStatus="update",this.dialogLoading=!1,this.dialogFormVisible=!0},update:function(){var n=this;this.$refs.form.validate(function(e){e&&(n.dialogLoading=!0,Object(d.d)(u({},n.form,{spec_item:n.form.spec_item.trim().split("\n")})).then(function(t){n.selectId&&n.form.goods_type_id!==n.selectId?(n.currentTableData.splice(n.currentIndex,1),n.currentTableData.length<=0&&n.$emit("refresh",!0)):n.$set(n.currentTableData,n.currentIndex,u({},n.currentTableData[n.currentIndex],{},t.data,{get_goods_type:u({},n.typeData.find(function(e){return e.goods_type_id===t.data.goods_type_id}))})),n.dialogFormVisible=!1,n.$message.success("操作成功")}).catch(function(){n.dialogLoading=!1}))})},handleIndex:function(e,t,n){var a=this,i=1<arguments.length&&void 0!==t?t:0,o=2<arguments.length&&void 0!==n&&n,r=this._getIdList(e);if(0!==r.length){if(!o){var s=this.currentTableData[e],l=s.spec_index?0:1;if(1<s.spec_index)return;if(0==l&&!this.auth.close)return;if(1==l&&!this.auth.index)return;return this.$set(this.currentTableData,e,u({},s,{spec_index:2})),void c(r,l,this)}this.$confirm("确定要执行该操作吗?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning",closeOnClickModal:!1}).then(function(){c(r,i,a)}).catch(function(){})}else this.$message.error("请选择要操作的数据");function c(n,a,i){Object(d.e)(n,a).then(function(){i.currentTableData.forEach(function(e,t){-1!==n.indexOf(e.spec_id)&&i.$set(i.currentTableData,t,u({},e,{spec_index:a}))}),i.$message.success("操作成功")})}},handleDelete:function(e){var t=this,n=this._getIdList(e);0!==n.length?this.$confirm("确定要执行该操作吗?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning",closeOnClickModal:!1}).then(function(){Object(d.b)(n).then(function(){for(var e=t.currentTableData.length-1;0<=e;e--)-1!==n.indexOf(t.currentTableData[e].spec_id)&&t.currentTableData.splice(e,1);t.currentTableData.length<=0&&t.$emit("refresh",!0),t.$message.success("操作成功")})}).catch(function(){}):this.$message.error("请选择要操作的数据")},handleSort:function(e){Object(d.f)(this.currentTableData[e].spec_id,this.currentTableData[e].sort)}}},r=n("2877"),s=Object(r.a)(o,function(){var n=this,e=n.$createElement,a=n._self._c||e;return a("div",{staticClass:"cs-p"},[a("el-form",{attrs:{inline:!0,size:"small"}},[n.auth.add?a("el-form-item",[a("el-button",{attrs:{disabled:n.loading},on:{click:n.handleCreate}},[a("cs-icon",{attrs:{name:"plus"}}),n._v("\n        新增规格\n      ")],1)],1):n._e(),a("el-form-item",[a("el-button-group",[n.auth.index?a("el-button",{attrs:{disabled:n.loading},on:{click:function(e){return n.handleIndex(null,1,!0)}}},[a("cs-icon",{attrs:{name:"check"}}),n._v("\n          设为检索\n        ")],1):n._e(),n.auth.close?a("el-button",{attrs:{disabled:n.loading},on:{click:function(e){return n.handleIndex(null,0,!0)}}},[a("cs-icon",{attrs:{name:"close"}}),n._v("\n          取消检索\n        ")],1):n._e()],1)],1),n.auth.del?a("el-form-item",[a("el-button",{attrs:{disabled:n.loading},on:{click:function(e){return n.handleDelete(null)}}},[a("cs-icon",{attrs:{name:"trash-o"}}),n._v("\n        删除\n      ")],1)],1):n._e(),a("cs-help",{staticStyle:{"padding-bottom":"19px"},attrs:{router:n.$route.path}})],1),a("el-table",{directives:[{name:"loading",rawName:"v-loading",value:n.loading,expression:"loading"}],attrs:{data:n.currentTableData},on:{"selection-change":n.handleSelectionChange,"sort-change":n.sortChange}},[a("el-table-column",{attrs:{type:"selection",width:"35"}}),a("el-table-column",{attrs:{label:"编号",prop:"spec_id",sortable:"custom",width:"100"}}),a("el-table-column",{attrs:{label:"名称",prop:"name",sortable:"custom"}}),a("el-table-column",{attrs:{label:"所属模型",prop:"get_goods_type.type_name"}}),a("el-table-column",{attrs:{label:"规格项",prop:"spec_item","show-overflow-tooltip":!0,"min-width":"200"},scopedSlots:n._u([{key:"default",fn:function(e){return[n._v("\n        "+n._s(n._f("getSpecItem")(e.row.spec_item))+"\n      ")]}}])}),a("el-table-column",{attrs:{label:"排序值",prop:"sort",sortable:"custom",align:"center","min-width":"110"},scopedSlots:n._u([{key:"default",fn:function(t){return[n.auth.sort?a("el-input-number",{staticStyle:{width:"88px"},attrs:{size:"mini","controls-position":"right",min:0,max:255},on:{change:function(e){return n.handleSort(t.$index)}},model:{value:t.row.sort,callback:function(e){n.$set(t.row,"sort",e)},expression:"scope.row.sort"}}):a("span",[n._v("\n          "+n._s(t.row.sort)+"\n        ")])]}}])}),a("el-table-column",{attrs:{label:"是否检索",prop:"spec_index",sortable:"custom",align:"center",width:"100"},scopedSlots:n._u([{key:"default",fn:function(t){return[a("el-tag",{style:n.auth.index||n.auth.close?"cursor: pointer;":"",attrs:{size:"mini",type:n.indexMap[t.row.spec_index].type,effect:n.auth.index||n.auth.close?"light":"plain"},nativeOn:{click:function(e){return n.handleIndex(t.$index)}}},[n._v("\n          "+n._s(n.indexMap[t.row.spec_index].text)+"\n        ")])]}}])}),a("el-table-column",{attrs:{label:"操作",align:"center","min-width":"100"},scopedSlots:n._u([{key:"default",fn:function(t){return[n.auth.set?a("el-button",{attrs:{size:"small",type:"text"},on:{click:function(e){return n.handleUpdate(t.$index)}}},[n._v("编辑")]):n._e(),n.auth.del?a("el-button",{attrs:{size:"small",type:"text"},on:{click:function(e){return n.handleDelete(t.$index)}}},[n._v("删除")]):n._e()]}}])})],1),a("el-dialog",{attrs:{title:n.textMap[n.dialogStatus],visible:n.dialogFormVisible,"append-to-body":!0,"close-on-click-modal":!1,width:"600px"},on:{"update:visible":function(e){n.dialogFormVisible=e}}},[a("el-form",{ref:"form",attrs:{model:n.form,rules:n.rules,"label-width":"80px"}},[a("el-form-item",{attrs:{label:"名称",prop:"name"}},[a("el-input",{attrs:{placeholder:"请输入商品规格名称",clearable:!0},model:{value:n.form.name,callback:function(e){n.$set(n.form,"name",e)},expression:"form.name"}})],1),a("el-form-item",{attrs:{label:"所属模型",prop:"goods_type_id"}},[a("el-select",{staticStyle:{width:"100%"},attrs:{placeholder:"请选择所属商品模型",clearable:"",value:""},model:{value:n.form.goods_type_id,callback:function(e){n.$set(n.form,"goods_type_id",e)},expression:"form.goods_type_id"}},n._l(n.typeData,function(e,t){return a("el-option",{key:t,attrs:{label:e.type_name,value:e.goods_type_id}})}),1)],1),a("el-form-item",{attrs:{label:"规格项",prop:"spec_item"}},[a("el-input",{attrs:{placeholder:"请输入商品规格项，一行一个",type:"textarea",rows:5},model:{value:n.form.spec_item,callback:function(e){n.$set(n.form,"spec_item",e)},expression:"form.spec_item"}})],1),a("el-form-item",{attrs:{label:"排序值",prop:"sort"}},[a("el-input-number",{staticStyle:{width:"120px"},attrs:{"controls-position":"right",min:0,max:255},model:{value:n.form.sort,callback:function(e){n.$set(n.form,"sort",e)},expression:"form.sort"}})],1),a("el-form-item",{attrs:{label:"是否检索",prop:"spec_index"}},[a("el-switch",{attrs:{"active-value":1,"inactive-value":0},model:{value:n.form.spec_index,callback:function(e){n.$set(n.form,"spec_index",e)},expression:"form.spec_index"}})],1)],1),a("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{attrs:{size:"small"},on:{click:function(e){n.dialogFormVisible=!1}}},[n._v("取消")]),"create"===n.dialogStatus?a("el-button",{attrs:{type:"primary",loading:n.dialogLoading,size:"small"},on:{click:n.create}},[n._v("确定")]):a("el-button",{attrs:{type:"primary",loading:n.dialogLoading,size:"small"},on:{click:n.update}},[n._v("修改")])],1)],1)],1)},[],!1,null,null,null);t.default=s.exports}}]);