(window.webpackJsonp=window.webpackJsonp||[]).push([["chunk-590f3d8b"],{"630f":function(e,t,a){"use strict";a.r(t);a("8e6e"),a("456d");var s=a("75fc"),n=(a("6762"),a("6b54"),a("bd86")),r=(a("ac6a"),a("7f7f"),a("ca7e")),o=a("ca00"),i=a("a308");function l(t,e){var a=Object.keys(t);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(t);e&&(s=s.filter(function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})),a.push.apply(a,s)}return a}function u(t){for(var e=1;e<arguments.length;e++){var a=null!=arguments[e]?arguments[e]:{};e%2?l(a,!0).forEach(function(e){Object(n.a)(t,e,a[e])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(a)):l(a).forEach(function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(a,e))})}return t}var c={props:{loading:{default:!1},treeData:{default:function(){return[]}},module:{default:function(){}},group:{default:function(){}}},data:function(){return{hackReset:!0,isExpandAll:!0,expanded:[],filterText:"",treeLoading:!1,treeProps:{label:"name",children:"children"},auth:{add:!1,del:!1,set:!1,enable:!1,disable:!1,move:!1},form:{module:void 0,group_id:void 0,name:void 0,menu_auth:[],log_auth:[],sort:50,status:"1"},menuData:[],formStatus:"create",formLoading:!1,formMap:{create:"新增权限",update:"编辑权限"},menuAuth:[],logAuth:[],rules:{name:[{required:!0,message:"名称不能为空",trigger:"blur"},{max:32,message:"长度不能大于 32 个字符",trigger:"blur"}],module:[{required:!0,message:"至少选择一项",trigger:"change"}],group_id:[{required:!0,message:"至少选择一项",trigger:"change"}],sort:[{type:"number",message:"必须为数字值",trigger:"blur"}]}}},watch:{filterText:function(e){this.$refs.tree.filter(e)},"form.module":{handler:function(e){this.switchModule(e)},deep:!0}},mounted:function(){this._validationAuth()},methods:{_validationAuth:function(){this.auth.add=this.$has("/system/auth/rule/add"),this.auth.del=this.$has("/system/auth/rule/del"),this.auth.set=this.$has("/system/auth/rule/set"),this.auth.enable=this.$has("/system/auth/rule/enable"),this.auth.disable=this.$has("/system/auth/rule/disable"),this.auth.move=this.$has("/system/auth/rule/move")},filterNode:function(e,t){return!e||-1!==t.name.indexOf(e)},checkedNodes:function(e){var t=this;this.filterText="",this.expanded=[],this.hackReset=!1,this.$nextTick(function(){t.isExpandAll=e,t.hackReset=!0})},remove:function(t,e){var a=this,s=!(1<arguments.length&&void 0!==e)||e;t&&t.length?this.$confirm("确定要执行该操作吗?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning",closeOnClickModal:!1}).then(function(){var e=t.filter(function(e){return!a.module.hasOwnProperty(e)});Object(r.b)(e).then(function(){e.forEach(function(e){a.$refs.tree.remove(e)}),s&&a.$refs.tree.setCheckedKeys([]),a.handleCreate("create"),a.$message.success("操作成功")})}).catch(function(){}):this.$message.error("请选择要操作的数据")},removeList:function(){this.remove(this.$refs.tree.getCheckedKeys(!0))},enable:function(t,a,e){var s=this,n=!(2<arguments.length&&void 0!==e)||e;t&&t.length?this.$confirm("确定要执行该操作吗?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning",closeOnClickModal:!1}).then(function(){var e=t.filter(function(e){return!s.module.hasOwnProperty(e)});Object(r.f)(e,a).then(function(){e.forEach(function(e){s.$refs.tree.getNode(e).data.status=a}),n&&s.$refs.tree.setCheckedKeys([]),s.$message.success("操作成功")})}).catch(function(){}):this.$message.error("请选择要操作的数据")},setStatusList:function(e){this.enable(this.$refs.tree.getCheckedKeys(!0),e)},setStatusItem:function(e,t){this.enable([e],t?0:1,!1)},handleNodeClick:function(e){(this.auth.add||this.auth.set)&&(e.system?this.handleCreate("create",e.module):(this.resetForm(),this.resetElements("update"),this.menuAuth=e.menu_auth,this.logAuth=e.log_auth,this.form=u({},e,{status:e.status.toString()}),this.group.hasOwnProperty(this.form.group_id)||(this.form.group_id=void 0)))},allowDrag:function(e){return!this.module.hasOwnProperty(e.key)&&this.auth.move},allowDrop:function(e,t,a){return!(e.parent!==t.parent||"inner"===a)},handleDrop:function(e,t){var a=this,s=[];t.parent.childNodes.forEach(function(e,t){s.push(e.key),e.data.sort=t+1}),Object(r.d)(s).catch(function(){a.$emit("refresh")})},switchModule:function(a){var s=this;a?(this.treeLoading=!0,Object(i.d)({module:a}).then(function(e){if(s.menuData=e.data.length?o.a.formatDataToTree(e.data):[],"update"===s.formStatus&&e.data.length){if(!s.menuAuth.length&&!s.logAuth.length)return;var t=[];if(e.data.forEach(function(e){e.children_total<=0&&t.push(e.menu_id)}),!t.length)return;s.form.menu_auth=s.menuAuth.filter(function(e){return t.includes(e)}),"api"===a&&(s.form.log_auth=s.logAuth.filter(function(e){return t.includes(e)}))}}).finally(function(){s.treeLoading=!1})):this.menuData=[]},resetForm:function(){this.form={module:"",group_id:"",name:"",menu_auth:[],log_auth:[],sort:50,status:"1"}},resetElements:function(e){var t=this,a=0<arguments.length&&void 0!==e?e:"create";this.$nextTick(function(){t.$refs.form.clearValidate()}),this.menuData=[],this.menuAuth=[],this.logAuth=[],this.formStatus=a,this.formLoading=!1},handleCreate:function(e,t){var a=1<arguments.length&&void 0!==t?t:null;this.resetForm(),this.resetElements(e),a&&(this.form.module=a)},_getCheckedKeys:function(){this.form.menu_auth=[].concat(Object(s.a)(this.$refs.menuTree.getCheckedKeys()),Object(s.a)(this.$refs.menuTree.getHalfCheckedKeys())),"api"===this.form.module&&(this.form.log_auth=[].concat(Object(s.a)(this.$refs.logTree.getCheckedKeys()),Object(s.a)(this.$refs.logTree.getHalfCheckedKeys())))},create:function(){var t=this;this.$refs.form.validate(function(e){e&&(t.formLoading=!0,t._getCheckedKeys(),Object(r.a)(u({},t.form)).then(function(){t.$emit("refresh"),t.$message.success("操作成功")}).catch(function(){t.formLoading=!1}))})},update:function(){var t=this;this.$refs.form.validate(function(e){e&&(t.formLoading=!0,t._getCheckedKeys(),Object(r.e)(u({},t.form)).then(function(){t.$emit("refresh"),t.$message.success("操作成功")}).catch(function(){t.formLoading=!1}))})}}},d=(a("8e0a"),a("2877")),f=Object(d.a)(c,function(){var s=this,e=s.$createElement,n=s._self._c||e;return n("div",{staticClass:"cs-p"},[n("el-form",{attrs:{inline:!0,size:"small"},nativeOn:{submit:function(e){e.preventDefault()}}},[s.auth.add?n("el-form-item",[n("el-button",{attrs:{disabled:s.loading},on:{click:function(e){return s.handleCreate("create")}}},[n("cs-icon",{attrs:{name:"plus"}}),s._v("\n        新增顶层权限\n      ")],1)],1):s._e(),n("el-form-item",[n("el-button-group",[s.auth.enable?n("el-button",{attrs:{disabled:s.loading},on:{click:function(e){return s.setStatusList(1)}}},[n("cs-icon",{attrs:{name:"check"}}),s._v("\n          启用\n        ")],1):s._e(),s.auth.disable?n("el-button",{attrs:{disabled:s.loading},on:{click:function(e){return s.setStatusList(0)}}},[n("cs-icon",{attrs:{name:"close"}}),s._v("\n          禁用\n        ")],1):s._e()],1)],1),n("el-form-item",[n("el-button-group",[n("el-button",{attrs:{disabled:s.loading},on:{click:function(e){return s.checkedNodes(!0)}}},[n("cs-icon",{attrs:{name:"plus-square-o"}}),s._v("\n          展开\n        ")],1),n("el-button",{attrs:{disabled:s.loading},on:{click:function(e){return s.checkedNodes(!1)}}},[n("cs-icon",{attrs:{name:"minus-square-o"}}),s._v("\n          收起\n        ")],1)],1)],1),s.auth.del?n("el-form-item",[n("el-button",{attrs:{disabled:s.loading},on:{click:s.removeList}},[n("cs-icon",{attrs:{name:"trash-o"}}),s._v("\n        删除\n      ")],1)],1):s._e(),n("el-form-item",{attrs:{label:"过滤"}},[n("el-input",{staticStyle:{width:"180px"},attrs:{disabled:s.loading,placeholder:"输入关键字进行过滤","prefix-icon":"el-icon-search"},model:{value:s.filterText,callback:function(e){s.filterText=e},expression:"filterText"}})],1),n("cs-help",{staticStyle:{"padding-bottom":"19px"},attrs:{router:s.$route.path}})],1),n("el-row",{attrs:{gutter:20}},[n("el-col",{directives:[{name:"loading",rawName:"v-loading",value:s.loading,expression:"loading"}],attrs:{span:10}},[s.hackReset?n("el-tree",{ref:"tree",staticClass:"tree-scroll",attrs:{"node-key":"rule_id",data:s.treeData,props:s.treeProps,"filter-node-method":s.filterNode,"highlight-current":!0,"default-expand-all":s.isExpandAll,"default-expanded-keys":s.expanded,"allow-drag":s.allowDrag,"allow-drop":s.allowDrop,draggable:!0,"show-checkbox":!0},on:{"node-click":s.handleNodeClick,"node-drop":s.handleDrop},scopedSlots:s._u([{key:"default",fn:function(e){var t=e.node,a=e.data;return n("span",{staticClass:"custom-tree-node action"},[n("span",{staticClass:"brother-showing",class:{"status-tree":!a.status}},[!a.system&&s.auth.move?n("i",{staticClass:"fa fa-align-justify move-tree cs-mr-10"}):s._e(),a.children?n("i",{class:"fa fa-folder-"+(t.expanded?"open-o":"o")}):n("i",{staticClass:"fa fa-file-o"}),s._v("\n            "+s._s(t.label)+"\n          ")]),a.system?n("span",{staticClass:"active"},[s.auth.add?n("el-button",{attrs:{type:"text",size:"mini"},on:{click:function(e){return e.stopPropagation(),s.handleCreate("create",t.key)}}},[s._v("\n              新增\n            ")]):s._e()],1):n("span",{staticClass:"active"},[s.auth.disable||s.auth.enable?n("el-button",{attrs:{type:"text",size:"mini"},on:{click:function(e){return e.stopPropagation(),s.setStatusItem(a.rule_id,a.status)}}},[s._v("\n              "+s._s(a.status?"禁用":"启用")+"\n            ")]):s._e(),s.auth.del?n("el-button",{attrs:{type:"text",size:"mini"},on:{click:function(e){return e.stopPropagation(),s.remove([a.rule_id],!1)}}},[s._v("\n              删除\n            ")]):s._e()],1)])}}],null,!1,2732159340)}):s._e()],1),n("el-col",{attrs:{span:14}},[s.auth.add||s.auth.set?n("el-card",{staticClass:"box-card",attrs:{shadow:"never"}},[n("div",{attrs:{slot:"header"},slot:"header"},[n("span",[s._v(s._s(s.formMap[s.formStatus]))]),"create"===s.formStatus&&s.auth.add?n("el-button",{staticStyle:{float:"right",padding:"3px 0"},attrs:{type:"text",loading:s.formLoading},on:{click:s.create}},[s._v("确定")]):"update"===s.formStatus&&s.auth.set?n("el-button",{staticStyle:{float:"right",padding:"3px 0"},attrs:{type:"text",loading:s.formLoading},on:{click:s.update}},[s._v("修改")]):s._e()],1),n("el-form",{ref:"form",attrs:{model:s.form,rules:s.rules,"label-width":"80px"}},[n("el-form-item",{attrs:{label:"名称",prop:"name"}},[n("el-input",{attrs:{placeholder:"请输入权限名称"},model:{value:s.form.name,callback:function(e){s.$set(s.form,"name",e)},expression:"form.name"}})],1),n("el-row",{attrs:{gutter:20}},[n("el-col",{attrs:{span:12}},[n("el-form-item",{attrs:{label:"模块",prop:"module"}},[n("el-select",{staticStyle:{width:"100%"},attrs:{placeholder:"请选择",value:""},model:{value:s.form.module,callback:function(e){s.$set(s.form,"module",e)},expression:"form.module"}},s._l(s.module,function(e,t){return n("el-option",{key:t,attrs:{label:e,value:t}})}),1)],1)],1),n("el-col",{attrs:{span:12}},[n("el-form-item",{attrs:{label:"用户组",prop:"group_id"}},[n("el-select",{staticStyle:{width:"100%"},attrs:{placeholder:"请选择",value:""},model:{value:s.form.group_id,callback:function(e){s.$set(s.form,"group_id",e)},expression:"form.group_id"}},s._l(s.group,function(e){return n("el-option",{key:e.group_id,attrs:{label:e.name,value:e.group_id}})}),1)],1)],1)],1),n("el-row",{attrs:{gutter:20}},[n("el-col",{attrs:{span:12}},[n("el-form-item",{attrs:{label:"排序",prop:"sort"}},[n("el-input-number",{staticStyle:{width:"120px"},attrs:{min:0,max:255,"controls-position":"right"},model:{value:s.form.sort,callback:function(e){s.$set(s.form,"sort",e)},expression:"form.sort"}})],1)],1),n("el-col",{attrs:{span:12}},[n("el-form-item",{attrs:{label:"状态",prop:"status"}},[n("el-switch",{attrs:{"active-value":"1","inactive-value":"0"},model:{value:s.form.status,callback:function(e){s.$set(s.form,"status",e)},expression:"form.status"}})],1)],1)],1)],1),n("div",{directives:[{name:"loading",rawName:"v-loading",value:s.treeLoading,expression:"treeLoading"}]},[n("el-collapse",[n("el-collapse-item",{attrs:{title:"菜单权限"}},[n("el-tree",{ref:"menuTree",attrs:{"node-key":"menu_id",data:s.menuData,props:s.treeProps,"default-checked-keys":s.form.menu_auth,"show-checkbox":!0},scopedSlots:s._u([{key:"default",fn:function(e){var t=e.node,a=e.data;return n("span",{staticClass:"custom-tree-node"},[n("span",{staticClass:"brother-showing",class:{"status-tree":!a.status}},[a.icon?n("i",{class:"fa fa-"+a.icon}):a.children?n("i",{class:"fa fa-folder-"+(t.expanded?"open-o":"o")}):n("i",{staticClass:"fa fa-file-o"}),s._v("\n                      "+s._s(t.label)+"\n                      "),a.url?n("i",{staticClass:"fa fa-link",staticStyle:{"font-size":"12px"}},[s._v("\n                        "+s._s(a.url)+"\n                      ")]):s._e()])])}}],null,!1,2795017150)})],1),"api"===s.form.module?n("el-collapse-item",{attrs:{title:"记录权限"}},[n("el-tree",{ref:"logTree",attrs:{"node-key":"menu_id",data:s.menuData,props:s.treeProps,"default-checked-keys":s.form.log_auth,"show-checkbox":!0},scopedSlots:s._u([{key:"default",fn:function(e){var t=e.node,a=e.data;return n("span",{staticClass:"custom-tree-node"},[n("span",{staticClass:"brother-showing",class:{"status-tree":!a.status}},[a.icon?n("i",{class:"fa fa-"+a.icon}):a.children?n("i",{class:"fa fa-folder-"+(t.expanded?"open-o":"o")}):n("i",{staticClass:"fa fa-file-o"}),s._v("\n                      "+s._s(t.label)+"\n                      "),a.url?n("i",{staticClass:"fa fa-link",staticStyle:{"font-size":"12px"}},[s._v("\n                        "+s._s(a.url)+"\n                      ")]):s._e()])])}}],null,!1,2795017150)})],1):s._e()],1)],1)],1):s._e()],1)],1)],1)},[],!1,null,"446197ac",null);t.default=f.exports},"65e9":function(e,t,a){},"8e0a":function(e,t,a){"use strict";var s=a("65e9");a.n(s).a}}]);