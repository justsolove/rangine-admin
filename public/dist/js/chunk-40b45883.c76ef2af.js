(window.webpackJsonp=window.webpackJsonp||[]).push([["chunk-40b45883"],{"1c42":function(e,t,r){"use strict";r.r(t);r("8e6e"),r("456d"),r("ac6a");var a=r("bd86"),n=r("f86b");function i(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(t);e&&(a=a.filter(function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})),r.push.apply(r,a)}return r}function o(t){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{};e%2?i(r,!0).forEach(function(e){Object(a.a)(t,e,r[e])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):i(r).forEach(function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(r,e))})}return t}var s={props:{loading:{default:!1},treeData:{default:function(){return[]}}},data:function(){return{filterText:"",expanded:[],treeProps:{label:"region_name",children:"children"},cascaderProps:{value:"region_id",label:"region_name",children:"children",checkStrictly:!0},formStatus:"create",formLoading:!1,textMap:{create:"新增区域",update:"编辑区域"},stateButton:{create:"确定",update:"修改"},auth:{add:!1,del:!1,set:!1,move:!1},form:{parent_id:void 0,region_name:void 0,sort:50},rules:{region_name:[{required:!0,message:"名称不能为空",trigger:"blur"},{max:120,message:"长度不能大于 120 个字符",trigger:"blur"}],sort:[{type:"number",message:"必须为数字值",trigger:"blur"}]}}},watch:{filterText:function(e){this.$refs.tree.filter(e)}},mounted:function(){this._validationAuth()},methods:{_validationAuth:function(){this.auth.add=this.$has("/setting/logistics/region/add"),this.auth.set=this.$has("/setting/logistics/region/set"),this.auth.del=this.$has("/setting/logistics/region/del"),this.auth.move=this.$has("/setting/logistics/region/move")},_getParentId:function(){var e=this.form.parent_id;return Array.isArray(e)?0<e.length?e[e.length-1]:0:e},filterNode:function(e,t){return!e||-1!==t.region_name.indexOf(e)},resetForm:function(){this.form={parent_id:[1],region_name:"",sort:50}},resetElements:function(e){var t=this,r=0<arguments.length&&void 0!==e?e:"create";this.$nextTick(function(){t.$refs.form.clearValidate()}),this.formStatus=r,this.formLoading=!1},refresh:function(){this.expanded=[],this.$emit("refresh")},handleNodeClick:function(e){(this.auth.add||this.auth.set)&&(this.resetForm(),this.resetElements("update"),this.form=o({},e))},handleCreate:function(e){this.resetForm(),this.resetElements(e),this.$refs.tree.getCurrentKey()&&this.$refs.tree.setCurrentKey(null)},handleAppend:function(e){this.handleCreate("create"),this.$refs.tree.setCurrentKey(e),this.form.parent_id=e},create:function(){var t=this;this.$refs.form.validate(function(e){e&&(t.formLoading=!0,Object(n.a)(o({},t.form,{parent_id:t._getParentId()})).then(function(e){t.expanded=[e.data.parent_id||e.data.region_id],t.$emit("refresh"),t.$message.success("操作成功")}).catch(function(){t.formLoading=!1}))})},update:function(){var t=this;this.$refs.form.validate(function(e){e&&(t.formLoading=!0,delete t.form.parent_id,Object(n.f)(o({},t.form)).then(function(e){t.expanded=[e.data.parent_id||e.data.region_id],t.$emit("refresh"),t.$message.success("操作成功")}).catch(function(){t.formLoading=!1}))})},remove:function(e){var t=this;e&&e.length?this.$confirm("确定要执行该操作吗?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning",closeOnClickModal:!1}).then(function(){Object(n.b)(e).then(function(){e.forEach(function(e){t.$refs.tree.remove(e)}),t.$refs.tree.setCheckedKeys([]),t.handleCreate("create"),t.$message.success("操作成功")})}).catch(function(){}):this.$message.error("请选择要操作的数据")},removeList:function(){this.remove(this.$refs.tree.getCheckedKeys())},allowDrag:function(){return this.auth.move},allowDrop:function(e,t,r){return!(e.parent!==t.parent||"inner"===r)},handleDrop:function(e,t){var r=this,a=[];t.parent.childNodes.forEach(function(e,t){a.push(e.key),e.data.sort=t+1}),Object(n.e)(a).catch(function(){r.$emit("refresh")})}}},l=(r("533c"),r("2877")),c=Object(l.a)(s,function(){var a=this,e=a.$createElement,n=a._self._c||e;return n("div",{staticClass:"cs-p"},[n("el-form",{attrs:{inline:!0,size:"small"},nativeOn:{submit:function(e){e.preventDefault()}}},[a.auth.add?n("el-form-item",[n("el-button",{attrs:{disabled:a.loading},on:{click:function(e){return a.handleCreate("create")}}},[n("cs-icon",{attrs:{name:"plus"}}),a._v("\n        新增顶层区域\n      ")],1)],1):a._e(),n("el-form-item",[n("el-button-group",[a.auth.del?n("el-button",{attrs:{disabled:a.loading},on:{click:a.removeList}},[n("cs-icon",{attrs:{name:"trash-o"}}),a._v("\n          删除\n        ")],1):a._e(),n("el-button",{attrs:{disabled:a.loading},on:{click:a.refresh}},[n("cs-icon",{attrs:{name:"refresh"}}),a._v("\n          刷新\n        ")],1)],1)],1),n("el-form-item",{attrs:{label:"过滤"}},[n("el-input",{staticStyle:{width:"180px"},attrs:{disabled:a.loading,placeholder:"输入关键字进行过滤","prefix-icon":"el-icon-search",clearable:!0},model:{value:a.filterText,callback:function(e){a.filterText=e},expression:"filterText"}})],1),n("cs-help",{staticStyle:{"padding-bottom":"19px"},attrs:{router:a.$route.path}})],1),n("el-row",{attrs:{gutter:20}},[n("el-col",{directives:[{name:"loading",rawName:"v-loading",value:a.loading,expression:"loading"}],attrs:{span:10}},[n("el-tree",{ref:"tree",staticClass:"tree-scroll",attrs:{"node-key":"region_id",data:a.treeData,props:a.treeProps,"filter-node-method":a.filterNode,"highlight-current":!0,"default-expanded-keys":a.expanded,"allow-drag":a.allowDrag,"allow-drop":a.allowDrop,draggable:!0,"show-checkbox":!0},on:{"node-click":a.handleNodeClick,"node-drop":a.handleDrop},scopedSlots:a._u([{key:"default",fn:function(e){var t=e.node,r=e.data;return n("span",{staticClass:"custom-tree-node action"},[n("span",{staticClass:"brother-showing"},[a.auth.move?n("i",{staticClass:"fa fa-align-justify move-tree",staticStyle:{width:"16px"}}):a._e(),a._v("\n            "+a._s(t.label)+"\n          ")]),n("span",{staticClass:"active"},[a.auth.add?n("el-button",{attrs:{type:"text",size:"mini"},on:{click:function(e){return e.stopPropagation(),a.handleAppend(r.region_id)}}},[a._v("\n              新增\n            ")]):a._e(),a.auth.del?n("el-button",{attrs:{type:"text",size:"mini"},on:{click:function(e){return e.stopPropagation(),a.remove([r.region_id])}}},[a._v("\n              删除\n            ")]):a._e()],1)])}}])})],1),n("el-col",{attrs:{span:14}},[a.auth.add||a.auth.set?n("el-card",{staticClass:"box-card",attrs:{shadow:"never"}},[n("div",{attrs:{slot:"header"},slot:"header"},[n("span",[a._v(a._s(a.textMap[a.formStatus]))]),"create"===a.formStatus&&a.auth.add?n("el-button",{staticStyle:{float:"right",padding:"3px 0"},attrs:{type:"text",loading:a.formLoading},on:{click:a.create}},[a._v("确定")]):"update"===a.formStatus&&a.auth.set?n("el-button",{staticStyle:{float:"right",padding:"3px 0"},attrs:{type:"text",loading:a.formLoading},on:{click:a.update}},[a._v("修改")]):a._e()],1),n("el-form",{ref:"form",attrs:{model:a.form,rules:a.rules,"label-width":"80px"}},[n("el-form-item",{attrs:{label:"上级区域",prop:"parent_id"}},[n("el-cascader",{staticStyle:{width:"100%"},attrs:{placeholder:"不选择表示顶层区域 试试搜索：浙江",disabled:"update"===a.formStatus,options:a.treeData,props:a.cascaderProps,filterable:"",clearable:""},model:{value:a.form.parent_id,callback:function(e){a.$set(a.form,"parent_id",e)},expression:"form.parent_id"}})],1),n("el-row",{attrs:{gutter:20}},[n("el-col",{attrs:{span:12}},[n("el-form-item",{attrs:{label:"名称",prop:"region_name"}},[n("el-input",{attrs:{placeholder:"请输入区域名称",clearable:!0},model:{value:a.form.region_name,callback:function(e){a.$set(a.form,"region_name",e)},expression:"form.region_name"}})],1)],1),n("el-col",{attrs:{span:12}},[n("el-form-item",{attrs:{label:"排序",prop:"sort"}},[n("el-input-number",{staticStyle:{width:"120px"},attrs:{min:0,max:255,"controls-position":"right"},model:{value:a.form.sort,callback:function(e){a.$set(a.form,"sort",e)},expression:"form.sort"}})],1)],1)],1)],1)],1):a._e()],1)],1)],1)},[],!1,null,"5e0691e0",null);t.default=c.exports},"533c":function(e,t,r){"use strict";var a=r("6141");r.n(a).a},6141:function(e,t,r){}}]);