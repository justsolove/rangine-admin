(window.webpackJsonp=window.webpackJsonp||[]).push([["chunk-2d995a94"],{2692:function(t,e,a){"use strict";a.r(e);a("8e6e"),a("456d"),a("ac6a"),a("6b54");var r=a("bd86"),s=a("57ab");function n(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),a.push.apply(a,r)}return a}function o(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?n(a,!0).forEach(function(t){Object(r.a)(e,t,a[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):n(a).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))})}return e}var i={props:{treeData:{default:function(){return[]}},loading:{default:!1}},data:function(){return{filterText:"",hackReset:!0,isExpandAll:!1,expanded:[],treeProps:{label:"cat_name",children:"children"},cascaderProps:{value:"article_cat_id",label:"cat_name",children:"children",checkStrictly:!0},formStatus:"create",formLoading:!1,textMap:{create:"新增分类",update:"编辑分类"},auth:{add:!1,del:!1,set:!1,move:!1},form:{parent_id:void 0,cat_name:void 0,cat_type:0,keywords:void 0,description:void 0,sort:50,is_navi:"1"},rules:{cat_name:[{required:!0,message:"名称不能为空",trigger:"blur"},{max:100,message:"长度不能大于 100 个字符",trigger:"blur"}],cat_type:[{type:"number",message:"必须为数字值",trigger:"blur"}],keywords:[{max:255,message:"长度不能大于 255 个字符",trigger:"blur"}],description:[{max:255,message:"长度不能大于 255 个字符",trigger:"blur"}],sort:[{type:"number",message:"必须为数字值",trigger:"blur"}]}}},watch:{filterText:function(t){this.$refs.tree.filter(t)}},mounted:function(){this._validationAuth()},methods:{_validationAuth:function(){this.auth.add=this.$has("/system/article/cat/add"),this.auth.set=this.$has("/system/article/cat/set"),this.auth.del=this.$has("/system/article/cat/del"),this.auth.move=this.$has("/system/article/cat/move")},_getParentId:function(){var t=this.form.parent_id;return Array.isArray(t)?0<t.length?t[t.length-1]:0:t},filterNode:function(t,e){return!t||-1!==e.cat_name.indexOf(t)},checkedNodes:function(t){var e=this;this.filterText="",this.expanded=[],this.hackReset=!1,this.$nextTick(function(){e.isExpandAll=t,e.hackReset=!0})},resetForm:function(){this.form={parent_id:[],cat_name:"",cat_type:0,keywords:"",description:"",sort:50,is_navi:"1"}},resetElements:function(t){var e=this,a=0<arguments.length&&void 0!==t?t:"create";this.$nextTick(function(){e.$refs.form.clearValidate()}),this.formStatus=a,this.formLoading=!1},handleCreate:function(t){this.resetForm(),this.resetElements(t),this.$refs.tree.getCurrentKey()&&this.$refs.tree.setCurrentKey(null)},handleAppend:function(t){this.handleCreate("create"),this.$refs.tree.setCurrentKey(t),this.form.parent_id=t},handleNodeClick:function(t){(this.auth.add||this.auth.set)&&(this.resetForm(),this.resetElements("update"),this.form=o({},t,{is_navi:t.is_navi.toString()}))},create:function(){var e=this;this.$refs.form.validate(function(t){t&&(e.formLoading=!0,Object(s.a)(o({},e.form,{parent_id:e._getParentId()})).then(function(t){e.isExpandAll||(e.expanded=[t.data.parent_id||t.data.article_cat_id]),e.$emit("refresh"),e.$message.success("操作成功")}).catch(function(){e.formLoading=!1}))})},update:function(){var e=this;this.$refs.form.validate(function(t){t&&(e.formLoading=!0,Object(s.e)(o({},e.form,{parent_id:e._getParentId()})).then(function(t){e.isExpandAll||(e.expanded=[t.data.parent_id||t.data.article_cat_id]),e.$emit("refresh"),e.$message.success("操作成功")}).catch(function(){e.formLoading=!1}))})},remove:function(t){var e=this,a="确定要执行该操作吗?",r=this.$refs.tree.getNode(t);(0<r.data.children_total||0<r.data.aricle_total)&&(a="该分类下有 ".concat(r.data.children_total," 个子分类，").concat(r.data.aricle_total," 篇关联文章，是否删除?")),this.$confirm(a,"提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning",closeOnClickModal:!1}).then(function(){Object(s.b)([t]).then(function(){e.$refs.tree.remove(r),e.handleCreate("create"),e.$message.success("操作成功")})}).catch(function(){})},handleDrop:function(e,t,a){var r=this,n={article_cat_id:e.data.article_cat_id,parent_id:e.data.parent_id},i=[];"inner"===a?n.parent_id=t.key:(n.parent_id=t.data.parent_id,t.parent.childNodes.forEach(function(t,e){i.push(t.key),t.data.sort=e+1})),Object(s.e)(o({},n)).then(function(t){e.data.parent_id=t.data.parent_id}).catch(function(){r.$emit("refresh")}),0<i.length&&Object(s.d)(i).catch(function(){r.$emit("refresh")})},allowDrag:function(){return this.auth.move}}},l=(a("af70"),a("2877")),c=Object(l.a)(i,function(){var r=this,t=r.$createElement,n=r._self._c||t;return n("div",{staticClass:"cs-p"},[n("el-form",{attrs:{inline:!0,size:"small"},nativeOn:{submit:function(t){t.preventDefault()}}},[r.auth.add?n("el-form-item",[n("el-button",{attrs:{disabled:r.loading},on:{click:function(t){return r.handleCreate("create")}}},[n("cs-icon",{attrs:{name:"plus"}}),r._v("\n        新增顶层分类\n      ")],1)],1):r._e(),n("el-form-item",[n("el-button-group",[n("el-button",{attrs:{disabled:r.loading},on:{click:function(t){return r.checkedNodes(!0)}}},[n("cs-icon",{attrs:{name:"plus-square-o"}}),r._v("\n          展开\n        ")],1),n("el-button",{attrs:{disabled:r.loading},on:{click:function(t){return r.checkedNodes(!1)}}},[n("cs-icon",{attrs:{name:"minus-square-o"}}),r._v("\n          收起\n        ")],1)],1)],1),n("el-form-item",{attrs:{label:"过滤"}},[n("el-input",{staticStyle:{width:"180px"},attrs:{disabled:r.loading,placeholder:"输入关键字进行过滤","prefix-icon":"el-icon-search",clearable:!0},model:{value:r.filterText,callback:function(t){r.filterText=t},expression:"filterText"}})],1),n("cs-help",{staticStyle:{"padding-bottom":"19px"},attrs:{router:r.$route.path}})],1),n("el-row",{attrs:{gutter:20}},[n("el-col",{directives:[{name:"loading",rawName:"v-loading",value:r.loading,expression:"loading"}],attrs:{span:10}},[r.hackReset?n("el-tree",{ref:"tree",staticClass:"tree-scroll",attrs:{"node-key":"article_cat_id",data:r.treeData,props:r.treeProps,"filter-node-method":r.filterNode,"highlight-current":!0,"default-expand-all":r.isExpandAll,"default-expanded-keys":r.expanded,"allow-drag":r.allowDrag,draggable:!0},on:{"node-click":r.handleNodeClick,"node-drop":r.handleDrop},scopedSlots:r._u([{key:"default",fn:function(t){var e=t.node,a=t.data;return n("span",{staticClass:"custom-tree-node action"},[n("span",{staticClass:"brother-showing"},[r.auth.move?n("i",{staticClass:"fa fa-align-justify move-tree cs-mr-10"}):r._e(),a.children?n("i",{class:"fa fa-folder-"+(e.expanded?"open-o":"o")}):n("i",{staticClass:"fa fa-file-o"}),r._v("\n            "+r._s(e.label)+"\n          ")]),n("span",{staticClass:"active"},[r.auth.add?n("el-button",{attrs:{type:"text",size:"mini"},on:{click:function(t){return t.stopPropagation(),r.handleAppend(a.article_cat_id)}}},[r._v("\n              新增\n            ")]):r._e(),r.auth.del?n("el-button",{attrs:{type:"text",size:"mini"},on:{click:function(t){return t.stopPropagation(),r.remove(a.article_cat_id)}}},[r._v("\n              删除\n            ")]):r._e()],1)])}}],null,!1,1049466222)}):r._e()],1),n("el-col",{attrs:{span:14}},[r.auth.add||r.auth.set?n("el-card",{staticClass:"box-card",attrs:{shadow:"never"}},[n("div",{attrs:{slot:"header"},slot:"header"},[n("span",[r._v(r._s(r.textMap[r.formStatus]))]),"create"===r.formStatus&&r.auth.add?n("el-button",{staticStyle:{float:"right",padding:"3px 0"},attrs:{type:"text",loading:r.formLoading},on:{click:r.create}},[r._v("确定")]):"update"===r.formStatus&&r.auth.set?n("el-button",{staticStyle:{float:"right",padding:"3px 0"},attrs:{type:"text",loading:r.formLoading},on:{click:r.update}},[r._v("修改")]):r._e()],1),n("el-form",{ref:"form",attrs:{model:r.form,rules:r.rules,"label-width":"80px"}},[n("el-form-item",{attrs:{label:"上级分类",prop:"parent_id"}},[n("el-cascader",{staticStyle:{width:"100%"},attrs:{placeholder:"不选择表示顶层分类 试试搜索：首页",options:r.treeData,props:r.cascaderProps,filterable:"",clearable:""},model:{value:r.form.parent_id,callback:function(t){r.$set(r.form,"parent_id",t)},expression:"form.parent_id"}})],1),n("el-row",{attrs:{gutter:20}},[n("el-col",{attrs:{span:12}},[n("el-form-item",{attrs:{label:"名称",prop:"cat_name"}},[n("el-input",{attrs:{placeholder:"请输入文章分类名称",clearable:!0},model:{value:r.form.cat_name,callback:function(t){r.$set(r.form,"cat_name",t)},expression:"form.cat_name"}})],1)],1),n("el-col",{attrs:{span:12}},[n("el-form-item",{attrs:{label:"类型",prop:"cat_type"}},[n("el-input-number",{staticStyle:{width:"120px"},attrs:{min:-128,max:127,"controls-position":"right"},model:{value:r.form.cat_type,callback:function(t){r.$set(r.form,"cat_type",t)},expression:"form.cat_type"}})],1)],1)],1),n("el-row",{attrs:{gutter:20}},[n("el-col",{attrs:{span:12}},[n("el-form-item",{attrs:{label:"排序",prop:"sort"}},[n("el-input-number",{staticStyle:{width:"120px"},attrs:{min:0,max:255,"controls-position":"right"},model:{value:r.form.sort,callback:function(t){r.$set(r.form,"sort",t)},expression:"form.sort"}})],1)],1)],1),n("el-form-item",{attrs:{label:"描述",prop:"description"}},[n("el-input",{attrs:{placeholder:"可输入文章分类描述",type:"textarea",rows:3},model:{value:r.form.description,callback:function(t){r.$set(r.form,"description",t)},expression:"form.description"}})],1)],1)],1):r._e()],1)],1)],1)},[],!1,null,"7bebf236",null);e.default=c.exports},"7beb":function(t,e,a){},af70:function(t,e,a){"use strict";var r=a("7beb");a.n(r).a}}]);